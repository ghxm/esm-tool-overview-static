---
layout: default
---

<!-- Tool Header - Always on top -->
<div class="row">
    <div class="col-12">
        <!-- Mobile Back Button -->
        <div class="d-lg-none mb-3">
            <a href="{{ '/' | relative_url }}" class="btn btn-outline-secondary btn-sm">
                ← Back to Overview
            </a>
        </div>
        
        <div class="mb-4">
            <h1 class="display-5">{{ page.name | default: page.title }}</h1>
            {% if page.description %}
                <p class="lead">{{ page.description }}</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8 order-lg-1 order-2">
        <!-- Tool Information - Front and Center -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Tool Information</h5>
            </div>
            <div class="card-body">
                {% for section in site.detail_info_sections %}
                    <h6 class="mt-3 mb-2 pb-1 border-bottom">{{ section.name }}</h6>
                    <dl class="row">
                        {% for field_name in section.fields %}
                            {% assign field_config = site.fields[field_name] %}
                            {% if field_config.display contains "detail_info" %}
                                {% include get_field_value.html field_name=field_name %}
                                {% assign value = field_value %}
                                {% assign has_value = false %}
                                {% if value and value != "" and value != nil %}
                                    {% if value.first %}
                                        {% comment %} Array - check if it has items {% endcomment %}
                                        {% if value.size > 0 %}
                                            {% assign has_value = true %}
                                        {% endif %}
                                    {% else %}
                                        {% comment %} Single value {% endcomment %}
                                        {% assign has_value = true %}
                                    {% endif %}
                                {% endif %}
                                {% if has_value or field_config.show_if_empty %}
                                    <dt class="col-sm-3 small">
                                        {{ field_config.label }}:
                                        {% if field_config.tooltip %}
                                            <i class="fas fa-question-circle text-muted ms-1" 
                                               data-bs-toggle="tooltip" 
                                               data-bs-placement="top" 
                                               data-bs-trigger="hover focus"
                                               title="{{ field_config.tooltip }}"></i>
                                        {% elsif field_config.popover %}
                                            <i class="fas fa-question-circle text-muted ms-1" 
                                               data-bs-toggle="popover" 
                                               data-bs-placement="top" 
                                               data-bs-trigger="click"
                                               data-bs-title="{{ field_config.popover.title }}"
                                               data-bs-content="{{ field_config.popover.content }}"></i>
                                        {% endif %}
                                    </dt>
                                    <dd class="col-sm-9">
                                        {% if value and value.first %}
                                            {% comment %} Arrays {% endcomment %}
                                            {% assign display_style = field_config.display_style | default: "string" %}
                                            {% if display_style == 'string' %}
                                                {% comment %} Display as comma-separated string {% endcomment %}
                                                {% assign display_items = '' %}
                                                {% for item in value %}
                                                    {% include apply_value_label.html value=item field_config=field_config %}
                                                    {% if forloop.first %}
                                                        {% assign display_items = display_value %}
                                                    {% else %}
                                                        {% assign display_items = display_items | append: ', ' | append: display_value %}
                                                    {% endif %}
                                                {% endfor %}
                                                {{ display_items }}
                                            {% elsif display_style == 'list' %}
                                                {% comment %} Display as bulleted list {% endcomment %}
                                                <ul class="mb-0">
                                                    {% for item in value %}
                                                        {% include apply_value_label.html value=item field_config=field_config %}
                                                        <li>{{ display_value }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                {% comment %} Display as badges (default) {% endcomment %}
                                                {% for item in value %}
                                                {% comment %} Apply value label transformation {% endcomment %}
                                                {% include apply_value_label.html value=item field_config=field_config %}
                                                {% assign display_item = display_value %}
                                                
                                                {% comment %} Get consistent color for this item {% endcomment %}
                                                {% assign base_badge_color = field_config.badge_color | default: "primary" %}
                                                {% include get_consistent_badge_color.html value=item base_color=base_badge_color %}
                                                {% assign item_color = consistent_color %}
                                                
                                                {% comment %} Check for value tooltip for this array item {% endcomment %}
                                                {% assign tooltip_field = nil %}
                                                {% if field_config.value_tooltips %}
                                                    {% assign item_lower = item | downcase %}
                                                    {% for tooltip_pair in field_config.value_tooltips %}
                                                        {% assign key_lower = tooltip_pair[0] | downcase %}
                                                        {% if key_lower == item_lower %}
                                                            {% assign tooltip_field = tooltip_pair[1] %}
                                                            {% break %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                                
                                                <span class="badge bg-{{ item_color }} me-1">{{ display_item }}{% if tooltip_field %}{% assign explanation = page[tooltip_field] %}{% if explanation %} <i class="fas fa-info-circle ms-1" data-bs-toggle="tooltip" title="{{ explanation }}"></i>{% endif %}{% endif %}</span>
                                                {% endfor %}
                                            {% endif %}
                                        {% elsif value != nil %}
                                            {% if value != "" or value == true or value == false %}
                                            {% comment %} Single values (including booleans) {% endcomment %}
                                            {% assign display_style = field_config.display_style | default: "string" %}
                                            {% if display_style == 'badge' %}
                                            {% comment %} Apply value label transformation {% endcomment %}
                                            {% include apply_value_label.html value=value field_config=field_config %}
                                            {% assign display_item = display_value %}
                                            
                                            {% comment %} Check for value tooltip for single badge value {% endcomment %}
                                            {% assign tooltip_field = nil %}
                                            {% if field_config.value_tooltips %}
                                                {% assign value_lower = value | downcase %}
                                                {% for tooltip_pair in field_config.value_tooltips %}
                                                    {% assign key_lower = tooltip_pair[0] | downcase %}
                                                    {% if key_lower == value_lower %}
                                                        {% assign tooltip_field = tooltip_pair[1] %}
                                                        {% break %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {% assign badge_color = field_config.badge_color | default: "primary" %}
                                            <span class="badge bg-{{ badge_color }}">{{ display_item }}{% if tooltip_field %}{% assign explanation = page[tooltip_field] %}{% if explanation %} <i class="fas fa-info-circle ms-1" data-bs-toggle="tooltip" title="{{ explanation }}"></i>{% endif %}{% endif %}</span>
                                            {% elsif value %}
                                            {% comment %} Apply value label transformation {% endcomment %}
                                            {% include apply_value_label.html value=value field_config=field_config %}
                                            {% assign display_item = display_value %}
                                            
                                            {% comment %} Check for value tooltip for single text value {% endcomment %}
                                            {% assign tooltip_field = nil %}
                                            {% if field_config.value_tooltips %}
                                                {% assign value_lower = value | downcase %}
                                                {% for tooltip_pair in field_config.value_tooltips %}
                                                    {% assign key_lower = tooltip_pair[0] | downcase %}
                                                    {% if key_lower == value_lower %}
                                                        {% assign tooltip_field = tooltip_pair[1] %}
                                                        {% break %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {{ display_item }}{% if tooltip_field %}{% assign explanation = page[tooltip_field] %}{% if explanation %} <i class="fas fa-info-circle ms-1" data-bs-toggle="tooltip" title="{{ explanation }}"></i>{% endif %}{% endif %}
                                            {% endif %}
                                            {% endif %}
                                        {% elsif field_config.show_if_empty %}
                                            <span class="text-muted">{% if field_config.empty_value %}{{ field_config.empty_value }}{% else %}{{ site.default_empty_value }}{% endif %}</span>
                                        {% endif %}
                                    </dd>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </dl>
                {% endfor %}
                
                <!-- Automatic "Other" section for uncategorized detail_info fields -->
                {% assign all_section_fields = "" | split: "," %}
                {% for section in site.detail_info_sections %}
                    {% assign all_section_fields = all_section_fields | concat: section.fields %}
                {% endfor %}
                
                {% assign other_fields = "" | split: "," %}
                {% for field in site.fields %}
                    {% assign field_name = field[0] %}
                    {% assign field_config = field[1] %}
                    {% if field_config.display contains "detail_info" %}
                        {% unless all_section_fields contains field_name %}
                            {% assign other_fields = other_fields | push: field_name %}
                        {% endunless %}
                    {% endif %}
                {% endfor %}
                
                {% if other_fields.size > 0 %}
                    <h6 class="mt-3 mb-2 pb-1 border-bottom">Other</h6>
                    <dl class="row">
                        {% for field_name in other_fields %}
                            {% assign field_config = site.fields[field_name] %}
                            {% include get_field_value.html field_name=field_name %}
                            {% assign value = field_value %}
                            {% assign has_value = false %}
                            {% if value and value != "" and value != nil %}
                                {% if field_config.type == 'array' %}
                                    {% if value.size > 0 %}
                                        {% assign has_value = true %}
                                    {% endif %}
                                {% else %}
                                    {% assign has_value = true %}
                                {% endif %}
                            {% endif %}
                            {% if has_value or field_config.show_if_empty %}
                                <dt class="col-sm-3 small">
                                    {{ field_config.label }}:
                                    {% if field_config.tooltip %}
                                        <i class="fas fa-question-circle text-muted ms-1" 
                                           data-bs-toggle="tooltip" 
                                           data-bs-placement="top" 
                                           data-bs-trigger="hover focus"
                                           title="{{ field_config.tooltip }}"></i>
                                    {% elsif field_config.popover %}
                                        <i class="fas fa-question-circle text-muted ms-1" 
                                           data-bs-toggle="popover" 
                                           data-bs-placement="top" 
                                           data-bs-trigger="click"
                                           data-bs-title="{{ field_config.popover.title }}"
                                           data-bs-content="{{ field_config.popover.content }}"></i>
                                    {% endif %}
                                </dt>
                                <dd class="col-sm-9">
                                    {% if value and value.first and value.size > 0 %}
                                        {% assign display_style = field_config.display_style | default: "badge" %}
                                        {% if display_style == 'string' %}
                                            {% comment %} Display as comma-separated string {% endcomment %}
                                            {% assign display_items = '' %}
                                            {% for item in value %}
                                                {% include apply_value_label.html value=item field_config=field_config %}
                                                {% if forloop.first %}
                                                    {% assign display_items = display_value %}
                                                {% else %}
                                                    {% assign display_items = display_items | append: ', ' | append: display_value %}
                                                {% endif %}
                                            {% endfor %}
                                            {{ display_items }}
                                        {% elsif display_style == 'list' %}
                                            {% comment %} Display as bulleted list {% endcomment %}
                                            <ul class="mb-0">
                                                {% for item in value %}
                                                    {% include apply_value_label.html value=item field_config=field_config %}
                                                    <li>{{ display_value }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% else %}
                                            {% comment %} Display as badges (default) {% endcomment %}
                                            {% for item in value %}
                                                {% comment %} Apply value label transformation {% endcomment %}
                                                {% include apply_value_label.html value=item field_config=field_config %}
                                                {% assign display_item = display_value %}
                                                
                                                {% comment %} Get consistent color for this item {% endcomment %}
                                                {% assign base_badge_color = field_config.badge_color | default: "primary" %}
                                                {% include get_consistent_badge_color.html value=item base_color=base_badge_color %}
                                                {% assign item_color = consistent_color %}
                                                
                                                <span class="badge bg-{{ item_color }} me-1">{{ display_item }}</span>
                                            {% endfor %}
                                        {% endif %}
                                    {% elsif field_config.type == 'date' and value %}
                                        {{ value | date: "%Y-%m-%d" }}
                                    {% elsif field_config.display_style == 'badge' and value %}
                                        {% assign badge_color = field_config.badge_color | default: "primary" %}
                                        {% include apply_value_label.html value=value field_config=field_config %}
                                        <span class="badge bg-{{ badge_color }}">{{ display_value }}</span>
                                    {% elsif value %}
                                        {% comment %} Single values display as text even with list style {% endcomment %}
                                        {% include apply_value_label.html value=value field_config=field_config %}
                                        {{ display_value }}
                                    {% elsif field_config.show_if_empty %}
                                        <span class="text-muted">{% if field_config.empty_value %}{{ field_config.empty_value }}{% else %}{{ site.default_empty_value }}{% endif %}</span>
                                    {% endif %}
                                </dd>
                            {% endif %}
                        {% endfor %}
                    </dl>
                {% endif %}
            </div>
        </div>

        <!-- Content -->
        {% assign content_stripped = content | strip %}
        {% if content_stripped and content_stripped != "" %}
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Details</h5>
                    <div class="card-text">
                        {{ content }}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="col-lg-4 order-lg-2 order-1">
        <!-- Overview Table -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Overview</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    {% for field in site.fields %}
                        {% assign field_name = field[0] %}
                        {% assign field_config = field[1] %}
                        {% if field_config.display contains "detail_overview" %}
                            {% include get_field_value.html field_name=field_name %}
                            {% assign value = field_value %}
                            {% assign has_value = false %}
                            {% if value and value != "" and value != nil %}
                                {% if field_config.type == 'array' %}
                                    {% if value.size > 0 %}
                                        {% assign has_value = true %}
                                    {% endif %}
                                {% else %}
                                    {% assign has_value = true %}
                                {% endif %}
                            {% endif %}
                            {% if has_value or field_config.show_if_empty %}
                                <dt class="col-sm-4 small">
                                    {{ field_config.label }}:
                                    {% if field_config.tooltip %}
                                        <i class="fas fa-question-circle text-muted ms-1" 
                                           data-bs-toggle="tooltip" 
                                           data-bs-placement="top" 
                                           data-bs-trigger="hover focus"
                                           title="{{ field_config.tooltip }}"></i>
                                    {% elsif field_config.popover %}
                                        <i class="fas fa-question-circle text-muted ms-1" 
                                           data-bs-toggle="popover" 
                                           data-bs-placement="top" 
                                           data-bs-trigger="click"
                                           data-bs-title="{{ field_config.popover.title }}"
                                           data-bs-content="{{ field_config.popover.content }}"></i>
                                    {% endif %}
                                </dt>
                                <dd class="col-sm-8">
                                    {% if field_name == 'name' and value %}
                                        <strong>{{ value }}</strong>
                                    {% elsif field_name == 'link' and value %}
                                        {% assign url_parts = value | split: '/' %}
                                        {% assign domain = url_parts[2] %}
                                        {% if url_parts.size > 4 %}
                                            {% assign short_url = domain | append: '/' | append: url_parts[3] | append: '/...' %}
                                        {% else %}
                                            {% assign short_url = value | remove: 'https://' | remove: 'http://' %}
                                            {% assign last_char = short_url | slice: -1 %}
                                            {% if last_char == '/' %}
                                                {% assign url_length = short_url | size | minus: 1 %}
                                                {% assign short_url = short_url | slice: 0, url_length %}
                                            {% endif %}
                                        {% endif %}
                                        <a href="{{ value }}" target="_blank" class="btn btn-sm btn-outline-primary text-break">
                                            {{ short_url }} ↗
                                        </a>
                                    {% elsif field_name == 'publication_url' and value %}
                                        {% assign url_parts = value | split: '/' %}
                                        {% assign domain = url_parts[2] %}
                                        {% if url_parts.size > 4 %}
                                            {% assign short_url = domain | append: '/' | append: url_parts[3] | append: '/...' %}
                                        {% else %}
                                            {% assign short_url = value | remove: 'https://' | remove: 'http://' %}
                                            {% assign last_char = short_url | slice: -1 %}
                                            {% if last_char == '/' %}
                                                {% assign url_length = short_url | size | minus: 1 %}
                                                {% assign short_url = short_url | slice: 0, url_length %}
                                            {% endif %}
                                        {% endif %}
                                        <a href="{{ value }}" target="_blank" class="btn btn-sm btn-outline-primary text-break">
                                            {{ short_url }} ↗
                                        </a>
                                    {% elsif field_config.display_style == 'badge' and value %}
                                        {% assign badge_color = field_config.badge_color | default: "primary" %}
                                        {% include apply_value_label.html value=value field_config=field_config %}
                                        <span class="badge bg-{{ badge_color }}">{{ display_value }}</span>
                                    {% elsif value %}
                                        {% comment %} Single values display as text even with list style {% endcomment %}
                                        {% include apply_value_label.html value=value field_config=field_config %}
                                        {{ display_value }}
                                    {% elsif field_config.show_if_empty %}
                                        <span class="text-muted">{% if field_config.empty_value %}{{ field_config.empty_value }}{% else %}{{ site.default_empty_value }}{% endif %}</span>
                                    {% endif %}
                                </dd>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </dl>
            </div>
        </div>

        <!-- Publication Section -->
        {% assign publication_citation = page.publication_citation %}
        {% assign publication_url = page.publication_url %}
        {% if publication_citation or publication_url %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Publication</h5>
                </div>
                <div class="card-body">
                    {% if publication_citation %}
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <p class="mb-2"><em>{{ publication_citation }}</em></p>
                                </div>
                                <button class="btn btn-sm btn-outline-secondary ms-2" 
                                        onclick="copyToClipboard('{{ publication_citation | escape }}')"
                                        title="Copy citation to clipboard">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    {% endif %}
                    {% if publication_url %}
                        <a href="{{ publication_url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            View Publication ↗
                        </a>
                    {% endif %}
                </div>
            </div>
        {% endif %}

        <!-- Navigation - Desktop only -->
        <div class="card d-none d-lg-block">
            <div class="card-body text-center">
                <a href="{{ '/' | relative_url }}" class="btn btn-outline-secondary">
                    ← Back to Overview
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Show temporary success feedback
        const event = new Event('clipboard-copy');
        document.dispatchEvent(event);
        
        // You could add a toast notification here
        console.log('Citation copied to clipboard');
    }, function(err) {
        console.error('Could not copy text: ', err);
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
    });
}

// Close other popovers when a new one is opened
document.addEventListener('DOMContentLoaded', function() {
    const popoverElements = document.querySelectorAll('[data-bs-toggle="popover"]');
    
    popoverElements.forEach(function(element) {
        element.addEventListener('click', function() {
            // Hide all other popovers
            popoverElements.forEach(function(otherElement) {
                if (otherElement !== element) {
                    const popover = bootstrap.Popover.getInstance(otherElement);
                    if (popover) {
                        popover.hide();
                    }
                }
            });
        });
    });
});
</script>